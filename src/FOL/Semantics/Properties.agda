open import FOL.Language
module FOL.Semantics.Properties (â„’ : Language) where

open import Foundation.Essential
open import Foundation.Data.Vec.SetTheoretic
  renaming (_âˆˆ_ to _âˆˆâƒ—_)

open import FOL.Syntax â„’
open import FOL.Syntax.Properties â„’
open import FOL.Semantics â„’

âŠ¨â‚œ-âˆ˜ : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ ğ“‹ Ïƒ t â†’ (ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨â‚œ t â‰¡ ğ“‹ âŠ¨â‚œ t [ Ïƒ ]â‚œ
âŠ¨â‚œ-âˆ˜ ğ“‹ Ïƒ = term-elim (Î» _ â†’ refl) H where
  H : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ (_âŠ¨â‚œ_ ğ“‹ âˆ˜ Ïƒ) âŠ¨â‚œ t â‰¡ ğ“‹ âŠ¨â‚œ t [ Ïƒ ]â‚œ) â†’
    (ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨â‚œ f $Ì‡ tâƒ— â‰¡ ğ“‹ âŠ¨â‚œ (f $Ì‡ tâƒ—) [ Ïƒ ]â‚œ
  H f tâƒ— IH = cong (funMap f) H2 where
    H2 : (ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨â‚œâƒ— tâƒ— â‰¡ ğ“‹ âŠ¨â‚œâƒ— tâƒ— [ Ïƒ ]â‚œâƒ—
    H2 rewrite âŠ¨â‚œâƒ—â‰¡mapâƒ— (ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) tâƒ— | âŠ¨â‚œâƒ—â‰¡mapâƒ— ğ“‹ (tâƒ— [ Ïƒ ]â‚œâƒ—) | []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ïƒ =
      mapâƒ— ((ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨â‚œ_) tâƒ—       â‰¡âŸ¨ map-ext IH âŸ©
      mapâƒ— (ğ“‹ âŠ¨â‚œ_ âˆ˜ _[ Ïƒ ]â‚œ) tâƒ—       â‰¡âŸ¨ map-âˆ˜ _ _ _ âŸ©
      mapâƒ— (ğ“‹ âŠ¨â‚œ_) (mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ—) âˆ

âˆ·â‚›âŠ¨â‚œâ†‘â‚œ : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ (x : D) ğ“‹ t â†’ ğ“‹ âŠ¨â‚œ t â‰¡ (x âˆ·â‚› ğ“‹) âŠ¨â‚œ â†‘â‚œ t
âˆ·â‚›âŠ¨â‚œâ†‘â‚œ x ğ“‹ t = âŠ¨â‚œ-âˆ˜ (x âˆ·â‚› ğ“‹) (#_ âˆ˜ suc) t

âŠ¨â‚œ-ext : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ {ğ“‹ ğ“Š} â†’ ğ“‹ â‰— ğ“Š â†’ âˆ€ t â†’ ğ“‹ âŠ¨â‚œ t â‰¡ ğ“Š âŠ¨â‚œ t
âŠ¨â‚œ-ext {ğ“‹} {ğ“Š} eq = term-elim eq H where
  H : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ ğ“‹ âŠ¨â‚œ t â‰¡ ğ“Š âŠ¨â‚œ t) â†’ ğ“‹ âŠ¨â‚œ (f $Ì‡ tâƒ—) â‰¡ ğ“Š âŠ¨â‚œ (f $Ì‡ tâƒ—)
  H f tâƒ— IH rewrite âŠ¨â‚œâƒ—â‰¡mapâƒ— ğ“‹ tâƒ— | âŠ¨â‚œâƒ—â‰¡mapâƒ— ğ“Š tâƒ— = cong (funMap f) (map-ext IH)

âŠ¨áµ©-ext : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ {ğ“‹ ğ“Š} â†’ ğ“‹ â‰— ğ“Š â†’ âˆ€ Ï† â†’ ğ“‹ âŠ¨áµ© Ï† â†” ğ“Š âŠ¨áµ© Ï†
âŠ¨áµ©-ext eq âŠ¥Ì‡ = â†”-refl
âŠ¨áµ©-ext eq (R $Ì‡ tâƒ—) = â†”-cong (Î» t â†’ relMap R t holds) (map-cong (âŠ¨â‚œ-ext eq) tâƒ—)
âŠ¨áµ©-ext eq (Ï† â†’Ì‡ Ïˆ) = â†”-cong-â†’ (âŠ¨áµ©-ext eq Ï†) (âŠ¨áµ©-ext eq Ïˆ)
âŠ¨áµ©-ext {ğ“‹} {ğ“Š} eq (âˆ€Ì‡ Ï†) = â†”-cong-Î  Î» x â†’ âŠ¨áµ©-ext (H x) Ï† where
  H : âˆ€ x â†’ x âˆ·â‚› ğ“‹ â‰— x âˆ·â‚› ğ“Š
  H x zero = refl
  H x (suc n) = eq n

âŠ¨áµ©-âˆ˜ : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ ğ“‹ Ï† Ïƒ â†’ (ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨áµ© Ï† â†” ğ“‹ âŠ¨áµ© Ï† [ Ïƒ ]áµ©
âŠ¨áµ©-âˆ˜ ğ“‹ âŠ¥Ì‡ Ïƒ = â†”-refl
âŠ¨áµ©-âˆ˜ ğ“‹ (R $Ì‡ tâƒ—) Ïƒ = â†”-cong (Î» t â†’ relMap R t holds) H where
  H = mapâƒ— ((ğ“‹ âŠ¨â‚œ_ âˆ˜ Ïƒ) âŠ¨â‚œ_) tâƒ—       â‰¡âŸ¨ map-cong (âŠ¨â‚œ-âˆ˜ ğ“‹ Ïƒ) tâƒ— âŸ©
      mapâƒ— (ğ“‹ âŠ¨â‚œ_ âˆ˜ _[ Ïƒ ]â‚œ) tâƒ—       â‰¡âŸ¨ map-âˆ˜ _ _ _ âŸ©
      mapâƒ— (ğ“‹ âŠ¨â‚œ_) (mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ—) âˆ
âŠ¨áµ©-âˆ˜ ğ“‹ (Ï† â†’Ì‡ Ïˆ) Ïƒ = â†”-cong-â†’ (âŠ¨áµ©-âˆ˜ ğ“‹ Ï† Ïƒ) (âŠ¨áµ©-âˆ˜ ğ“‹ Ïˆ Ïƒ)
âŠ¨áµ©-âˆ˜ ğ“‹ (âˆ€Ì‡ Ï†) Ïƒ = â†”-cong-Î  Î» x â†’
  (x âˆ·â‚› (ğ“‹ âŠ¨â‚œ_) âˆ˜ Ïƒ) âŠ¨áµ© Ï†               â†”âŸ¨ âŠ¨áµ©-ext (H x) Ï† âŸ©
  ((x âˆ·â‚› ğ“‹) âŠ¨â‚œ_ âˆ˜ (# 0 âˆ·â‚› â†‘â‚œ âˆ˜ Ïƒ)) âŠ¨áµ© Ï† â†”âŸ¨ âŠ¨áµ©-âˆ˜ (x âˆ·â‚› ğ“‹) Ï† (# 0 âˆ·â‚› â†‘â‚œ âˆ˜ Ïƒ) âŸ©
  (x âˆ·â‚› ğ“‹) âŠ¨áµ© Ï† [ # 0 âˆ·â‚› â†‘â‚œ âˆ˜ Ïƒ ]áµ©      â†”âˆ
  where
  H : âˆ€ x â†’ x âˆ·â‚› (ğ“‹ âŠ¨â‚œ_) âˆ˜ Ïƒ â‰— (x âˆ·â‚› ğ“‹) âŠ¨â‚œ_ âˆ˜ (# 0 âˆ·â‚› â†‘â‚œ âˆ˜ Ïƒ)
  H x zero = refl
  H x (suc n) = âˆ·â‚›âŠ¨â‚œâ†‘â‚œ x ğ“‹ (Ïƒ n)

âˆ·â‚›âŠ¨áµ©â†‘áµ© : â¦ƒ _ : Interpretation D â¦„ â†’
  âˆ€ (x : D) ğ“‹ Ï† â†’ ğ“‹ âŠ¨áµ© Ï† â†” (x âˆ·â‚› ğ“‹) âŠ¨áµ© â†‘áµ© Ï†
âˆ·â‚›âŠ¨áµ©â†‘áµ© x ğ“‹ Ï† = âŠ¨áµ©-âˆ˜ (x âˆ·â‚› ğ“‹) Ï† (#_ âˆ˜ suc)
