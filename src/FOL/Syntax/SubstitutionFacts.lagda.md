---
url: fol.syntax.substitution
---

# ä¸€é˜¶é€»è¾‘ â–¸ è¯­æ³• â–¸á¨ æ›¿æ¢çš„æ€§è´¨

è¿™æ˜¯ä¸€ç¯‡æ ‡é¢˜ä¸­å¸¦ä¸Šæ ‡å‡å· (á¨) çš„ç« èŠ‚. è¿™è¡¨ç¤ºè¿™ç§ç« èŠ‚ä¸æ¨èçº¿æ€§é˜…è¯», è¯»è€…åº”è¯¥åœ¨éœ€è¦æ—¶å†å›æ¥æŸ¥çœ‹. å› ä¸ºè¿™ç§ç« èŠ‚åªæ˜¯ä¸€äº›æ¯ç‡¥å¼•ç†åŠå…¶è¯æ˜çš„ç®€å•ç½—åˆ—, è€Œä¸åŒ…å«åŠ¨æœºçš„è¯´æ˜. è¯»è€…åº”è¯¥åœ¨ä½¿ç”¨è¿™äº›å¼•ç†çš„ç« èŠ‚ä¸­å¯»æ‰¾åŠ¨æœº.

```agda
open import Foundation.Essential
open import FOL.Language
module FOL.Syntax.SubstitutionFacts (â„’ : Language) where

open import FOL.Syntax.Base â„’
open import FOL.Syntax.FreshVariables â„’

private variable
  n : â„•
  Ïƒ Ï„ : Subst
```

## æ’ç­‰æ›¿æ¢

```agda
[id]â‚œ : Ïƒ â‰— # â†’ âˆ€ t â†’ t [ Ïƒ ]â‚œ â‰¡ t
[id]â‚œ {Ïƒ} eq = term-elim eq H where
  H : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ t [ Ïƒ ]â‚œ â‰¡ t) â†’ (f $Ì‡ tâƒ—) [ Ïƒ ]â‚œ â‰¡ (f $Ì‡ tâƒ—)
  H f tâƒ— IH rewrite []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ïƒ = cong (f $Ì‡_) $
    mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ— â‰¡âŸ¨ mapâƒ—-ext IH âŸ©
    mapâƒ— id tâƒ—        â‰¡âŸ¨ mapâƒ—-id tâƒ— âŸ©
    tâƒ—               âˆ
```

```agda
[#]â‚œ : t [ # ]â‚œ â‰¡ t
[#]â‚œ = [id]â‚œ (Î» _ â†’ refl) _
```

```agda
â†‘â‚›-id : Ïƒ â‰— # â†’ â†‘â‚› Ïƒ â‰— #
â†‘â‚›-id eq zero = refl
â†‘â‚›-id eq (suc n) = cong â†‘â‚œ (eq n)
```

```agda
[id]áµ© : Ïƒ â‰— # â†’ âˆ€ Ï† â†’ Ï† [ Ïƒ ]áµ© â‰¡ Ï†
[id]áµ© eq âŠ¥Ì‡        = refl
[id]áµ© eq (Ï† â†’Ì‡ Ïˆ)  = cong2 _â†’Ì‡_ ([id]áµ© eq Ï†) ([id]áµ© eq Ïˆ)
[id]áµ© eq (âˆ€Ì‡ Ï†)    = cong âˆ€Ì‡_ ([id]áµ© (â†‘â‚›-id eq) Ï†)
[id]áµ© {Ïƒ} eq (R $Ì‡ tâƒ—) = cong (R $Ì‡_) $
  mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ— â‰¡âŸ¨ mapâƒ—-ext (Î» t _ â†’ [id]â‚œ eq t) âŸ©
  mapâƒ— id tâƒ—        â‰¡âŸ¨ mapâƒ—-id tâƒ— âŸ©
  tâƒ—               âˆ
```

```agda
[#]áµ© : Ï† [ # ]áµ© â‰¡ Ï†
[#]áµ© = [id]áµ© (Î» _ â†’ refl) _
```

## æ›¿æ¢çš„å¤åˆ

```agda
[]â‚œ-âˆ˜-â‰— : âˆ€ Ïƒ Ï„ Î¸ â†’ _[ Ï„ ]â‚œ âˆ˜ Ïƒ â‰— Î¸ â†’ _[ Ï„ ]â‚œ âˆ˜ _[ Ïƒ ]â‚œ â‰— _[ Î¸ ]â‚œ
[]â‚œ-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq = term-elim (Î» n â†’ eq n) H where
  H : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ t [ Ïƒ ]â‚œ [ Ï„ ]â‚œ â‰¡ t [ Î¸ ]â‚œ) â†’ (f $Ì‡ tâƒ—) [ Ïƒ ]â‚œ [ Ï„ ]â‚œ â‰¡ (f $Ì‡ tâƒ—) [ Î¸ ]â‚œ
  H f tâƒ— IH = cong (f $Ì‡_) H2 where
    H2 : (tâƒ— [ Ïƒ ]â‚œâƒ—) [ Ï„ ]â‚œâƒ— â‰¡ tâƒ— [ Î¸ ]â‚œâƒ—
    H2 rewrite []â‚œâƒ—â‰¡mapâƒ— (tâƒ— [ Ïƒ ]â‚œâƒ—) Ï„ | []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ïƒ | []â‚œâƒ—â‰¡mapâƒ— tâƒ— Î¸ =
      mapâƒ— (_[ Ï„ ]â‚œ) (mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ—) â‰¡Ë˜âŸ¨ mapâƒ—-âˆ˜ _ _ _ âŸ©
      mapâƒ— (_[ Ï„ ]â‚œ âˆ˜ _[ Ïƒ ]â‚œ) tâƒ—       â‰¡âŸ¨ mapâƒ—-ext IH âŸ©
      mapâƒ— (_[ Î¸ ]â‚œ) tâƒ—                 âˆ
```

```agda
[]â‚œ-âˆ˜ : _[ Ï„ ]â‚œ âˆ˜ _[ Ïƒ ]â‚œ â‰— _[ _[ Ï„ ]â‚œ âˆ˜ Ïƒ ]â‚œ
[]â‚œ-âˆ˜ = []â‚œ-âˆ˜-â‰— _ _ _ (Î» _ â†’ refl)
```

```agda
â†‘â‚›-âˆ˜-â‰— : âˆ€ Ïƒ Ï„ Î¸ â†’ _[ Ï„ ]â‚œ âˆ˜ Ïƒ â‰— Î¸ â†’ _[ â†‘â‚› Ï„ ]â‚œ âˆ˜ â†‘â‚› Ïƒ â‰— â†‘â‚› Î¸
â†‘â‚›-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq zero = refl
â†‘â‚›-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq (suc n) =
  (_[ â†‘â‚› Ï„ ]â‚œ âˆ˜ â†‘â‚› Ïƒ) (suc n)   â‰¡âŸ¨âŸ©
  (Ïƒ n) [ # âˆ˜ suc ]â‚œ [ â†‘â‚› Ï„ ]â‚œ  â‰¡âŸ¨ []â‚œ-âˆ˜ (Ïƒ n) âŸ©
  (Ïƒ n) [ â†‘â‚œ âˆ˜ Ï„ ]â‚œ             â‰¡Ë˜âŸ¨ []â‚œ-âˆ˜ (Ïƒ n) âŸ©
  (Ïƒ n) [ Ï„ ]â‚œ [ # âˆ˜ suc ]â‚œ     â‰¡âŸ¨âŸ©
  â†‘â‚œ ((Ïƒ n) [ Ï„ ]â‚œ)             â‰¡âŸ¨ cong â†‘â‚œ (eq n) âŸ©
  â†‘â‚œ (Î¸ n)                      â‰¡âŸ¨âŸ©
  â†‘â‚› Î¸ (suc n)                  âˆ
```

```agda
[]áµ©-âˆ˜-â‰— : âˆ€ Ïƒ Ï„ Î¸ â†’ _[ Ï„ ]â‚œ âˆ˜ Ïƒ â‰— Î¸ â†’ _[ Ï„ ]áµ© âˆ˜ _[ Ïƒ ]áµ© â‰— _[ Î¸ ]áµ©
[]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq âŠ¥Ì‡       = refl
[]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq (Ï† â†’Ì‡ Ïˆ) = cong2 _â†’Ì‡_ ([]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq Ï†) ([]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq Ïˆ)
[]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq (âˆ€Ì‡ Ï†)   = cong âˆ€Ì‡_ $ []áµ©-âˆ˜-â‰— (â†‘â‚› Ïƒ) (â†‘â‚› Ï„) (â†‘â‚› Î¸) (â†‘â‚›-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq) Ï†
[]áµ©-âˆ˜-â‰— Ïƒ Ï„ Î¸ eq (R $Ì‡ tâƒ—) = cong (R $Ì‡_) H where
  H = mapâƒ— (_[ Ï„ ]â‚œ) (mapâƒ— (_[ Ïƒ ]â‚œ) tâƒ—) â‰¡Ë˜âŸ¨ mapâƒ—-âˆ˜ _ _ _ âŸ©
      mapâƒ— (_[ Ï„ ]â‚œ âˆ˜ _[ Ïƒ ]â‚œ) tâƒ—       â‰¡âŸ¨ mapâƒ—-ext (Î» t _ â†’ []â‚œ-âˆ˜-â‰— _ _ _ eq t) âŸ©
      mapâƒ— (_[ Î¸ ]â‚œ) tâƒ—                 âˆ
```

```agda
[]áµ©-âˆ˜ : _[ Ï„ ]áµ© âˆ˜ _[ Ïƒ ]áµ© â‰— _[ _[ Ï„ ]â‚œ âˆ˜ Ïƒ ]áµ©
[]áµ©-âˆ˜ = []áµ©-âˆ˜-â‰— _ _ _ (Î» _ â†’ refl)
```

```agda
[]áµ©âˆ˜[]â‚€ : _[ Ïƒ ]áµ© âˆ˜ _[ t ]â‚€ â‰— _[ t [ Ïƒ ]â‚œ ]â‚€ âˆ˜ _[ â†‘â‚› Ïƒ ]áµ©
[]áµ©âˆ˜[]â‚€ {Ïƒ} {t} Ï† =
  Ï† [ t ]â‚€ [ Ïƒ ]áµ©           â‰¡âŸ¨ []áµ©-âˆ˜ _ âŸ©
  Ï† [ _[ Ïƒ ]â‚œ âˆ˜ (t âˆ·â‚™ #) ]áµ© â‰¡Ë˜âŸ¨ []áµ©-âˆ˜-â‰— (â†‘â‚› Ïƒ) (t [ Ïƒ ]â‚œ âˆ·â‚™ #) _ H Ï† âŸ©
  Ï† [ â†‘â‚› Ïƒ ]áµ© [ t [ Ïƒ ]â‚œ ]â‚€ âˆ where
    H : _[ t [ Ïƒ ]â‚œ âˆ·â‚™ # ]â‚œ âˆ˜ â†‘â‚› Ïƒ â‰— _[ Ïƒ ]â‚œ âˆ˜ (t âˆ·â‚™ #)
    H zero = refl
    H (suc n) =
      (Ïƒ n) [ # âˆ˜ suc ]â‚œ [ t [ Ïƒ ]â‚œ âˆ·â‚™ # ]â‚œ     â‰¡âŸ¨ []â‚œ-âˆ˜ (Ïƒ n) âŸ©
      (Ïƒ n) [ _[ t [ Ïƒ ]â‚œ âˆ·â‚™ # ]â‚œ âˆ˜ # âˆ˜ suc ]â‚œ  â‰¡âŸ¨ [#]â‚œ âŸ©
      Ïƒ n                                       âˆ
```

```agda
â†‘áµ©[]â‚€ : (â†‘áµ© Ï†) [ t ]â‚€ â‰¡ Ï†
â†‘áµ©[]â‚€ {Ï†} {t} =
  (â†‘áµ© Ï†) [ t ]â‚€                 â‰¡âŸ¨ []áµ©-âˆ˜ Ï† âŸ©
  Ï† [ _[ t âˆ·â‚™ # ]â‚œ âˆ˜ # âˆ˜ suc ]áµ© â‰¡âŸ¨ [#]áµ© âŸ©
  Ï†                             âˆ
```

## æ›¿æ¢çš„å¤–å»¶æ€§

```agda
[]â‚œ-ext : Ïƒ â‰— Ï„ â†’ _[ Ïƒ ]â‚œ â‰— _[ Ï„ ]â‚œ
[]â‚œ-ext {Ïƒ} {Ï„} eq = term-elim eq H where
  H : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ t [ Ïƒ ]â‚œ â‰¡ t [ Ï„ ]â‚œ) â†’ (f $Ì‡ tâƒ—) [ Ïƒ ]â‚œ â‰¡ (f $Ì‡ tâƒ—) [ Ï„ ]â‚œ
  H f tâƒ— IH = cong (f $Ì‡_) H2 where
    H2 : tâƒ— [ Ïƒ ]â‚œâƒ— â‰¡ tâƒ— [ Ï„ ]â‚œâƒ—
    H2 rewrite []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ïƒ | []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ï„ = mapâƒ—-ext IH
```

```agda
â†‘â‚›-ext : Ïƒ â‰— Ï„ â†’ â†‘â‚› Ïƒ â‰— â†‘â‚› Ï„
â†‘â‚›-ext eq zero = refl
â†‘â‚›-ext eq (suc n) = cong â†‘â‚œ (eq n)
```

```agda
[]áµ©-ext : Ïƒ â‰— Ï„ â†’ _[ Ïƒ ]áµ© â‰— _[ Ï„ ]áµ©
[]áµ©-ext eq âŠ¥Ì‡        = refl
[]áµ©-ext eq (Ï† â†’Ì‡ Ïˆ)  = cong2 _â†’Ì‡_ ([]áµ©-ext eq Ï†) ([]áµ©-ext eq Ïˆ)
[]áµ©-ext eq (âˆ€Ì‡ Ï†)    = cong âˆ€Ì‡_ ([]áµ©-ext (â†‘â‚›-ext eq) Ï†)
[]áµ©-ext eq (R $Ì‡ tâƒ—)  = cong (R $Ì‡_) (mapâƒ—-ext Î» t _ â†’ []â‚œ-ext eq t)
```

```agda
â†‘áµ©âˆ˜[]áµ© : â†‘áµ© âˆ˜ _[ Ïƒ ]áµ© â‰— _[ â†‘â‚› Ïƒ ]áµ© âˆ˜ â†‘áµ©
â†‘áµ©âˆ˜[]áµ© {Ïƒ} Ï† =
  Ï† [ Ïƒ ]áµ© [ # âˆ˜ suc ]áµ©       â‰¡âŸ¨ []áµ©-âˆ˜ _ âŸ©
  Ï† [ _[ # âˆ˜ suc ]â‚œ âˆ˜ Ïƒ ]áµ©    â‰¡âŸ¨ []áµ©-ext (Î» _ â†’ refl) Ï† âŸ©
  Ï† [ _[ â†‘â‚› Ïƒ ]â‚œ âˆ˜ # âˆ˜ suc ]áµ© â‰¡Ë˜âŸ¨ []áµ©-âˆ˜ _ âŸ©
  Ï† [ # âˆ˜ suc ]áµ© [ â†‘â‚› Ïƒ ]áµ©    âˆ
```

```agda
â†‘âˆ˜[] : â†‘ (map (_[ Ïƒ ]áµ©) Î“) â‰¡ map (_[ â†‘â‚› Ïƒ ]áµ©) (â†‘ Î“)
â†‘âˆ˜[] {Ïƒ} {Î“} =
  â†‘ (map (_[ Ïƒ ]áµ©) Î“)      â‰¡Ë˜âŸ¨ map-âˆ˜ Î“ âŸ©
  map (â†‘áµ© âˆ˜ _[ Ïƒ ]áµ©) Î“     â‰¡âŸ¨ map-ext (Î» t _ â†’ â†‘áµ©âˆ˜[]áµ© t) âŸ©
  map (_[ â†‘â‚› Ïƒ ]áµ© âˆ˜ â†‘áµ©) Î“  â‰¡âŸ¨ map-âˆ˜ Î“ âŸ©
  map (_[ â†‘â‚› Ïƒ ]áµ©) (â†‘ Î“)   âˆ
```

```agda
â†‘â‚›[]â‚€ : Ï† [ â†‘â‚› (# âˆ˜ suc) ]áµ© [ # 0 ]â‚€ â‰¡ Ï†
â†‘â‚›[]â‚€ {Ï†} = []áµ©-âˆ˜ Ï† âˆ™ (sym $ []áµ©-ext H Ï†) âˆ™ [#]áµ© where
  H : # â‰— _[ # 0 âˆ·â‚™ # ]â‚œ âˆ˜ (â†‘â‚› (# âˆ˜ suc))
  H zero = refl
  H (suc n) = refl
```

## å«æ–°å˜å…ƒçš„æ›¿æ¢

**<u>å¼•ç†</u>** å¦‚æœå¯¹ä»»æ„ `n`, è¦ä¹ˆ `n` å¯¹ `t` æ˜¯æ–°å˜å…ƒ, è¦ä¹ˆ `Ïƒ` ä¸ `Ï„` åœ¨è¯¥å¤„å–å€¼ç›¸ç­‰, é‚£ä¹ˆ `t [ Ïƒ ]â‚œ â‰¡ t [ Ï„ ]â‚œ`.  

```agda
[]â‚œ-ext-freshâ‚œ-dec : Decâ„™ P â†’ (âˆ€ n â†’ Â¬ P n â†’ Ïƒ n â‰¡ Ï„ n) â†’
  âˆ€ t â†’ (âˆ€ n â†’ P n â†’ freshâ‚œ n t) â†’ t [ Ïƒ ]â‚œ â‰¡ t [ Ï„ ]â‚œ
[]â‚œ-ext-freshâ‚œ-dec {P} {Ïƒ} {Ï„} decP Hext = term-elim H# H$Ì‡ where
  H# : âˆ€ m â†’ (âˆ€ n â†’ P n â†’ freshâ‚œ n (# m)) â†’ # m [ Ïƒ ]â‚œ â‰¡ # m [ Ï„ ]â‚œ
  H# m Hfresh with decP m
  ... | no Â¬Pm = Hext m Â¬Pm
  ... | yes Pm = exfalso $ fresh#-elim (Hfresh m Pm) refl
  H$Ì‡ : âˆ€ f tâƒ— â†’ (âˆ€ t â†’ t âˆˆâƒ— tâƒ— â†’ (âˆ€ n â†’ P n â†’ freshâ‚œ n t) â†’ t [ Ïƒ ]â‚œ â‰¡ t [ Ï„ ]â‚œ) â†’
    (âˆ€ n â†’ P n â†’ freshâ‚œ n (f $Ì‡ tâƒ—)) â†’ (f $Ì‡ tâƒ—) [ Ïƒ ]â‚œ â‰¡ (f $Ì‡ tâƒ—) [ Ï„ ]â‚œ
  H$Ì‡ f tâƒ— IH Hfresh rewrite []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ïƒ | []â‚œâƒ—â‰¡mapâƒ— tâƒ— Ï„ = cong (f $Ì‡_) $ mapâƒ—-ext
    Î» t tâˆˆâƒ— â†’ IH t tâˆˆâƒ— Î» n Pn â†’ fresh$Ì‡-elim (Hfresh n Pn) t tâˆˆâƒ—
```

```agda
[]áµ©-ext-fresháµ©-dec : Decâ„™ P â†’ (âˆ€ n â†’ Â¬ P n â†’ Ïƒ n â‰¡ Ï„ n) â†’
  âˆ€ Ï† â†’ (âˆ€ n â†’ P n â†’ fresháµ© n Ï†) â†’ Ï† [ Ïƒ ]áµ© â‰¡ Ï† [ Ï„ ]áµ©
[]áµ©-ext-fresháµ©-dec _ _ âŠ¥Ì‡ _ = refl
[]áµ©-ext-fresháµ©-dec decP Hext (R $Ì‡ tâƒ—) Hfresh = cong (R $Ì‡_) $ mapâƒ—-ext
  Î» t tâˆˆâƒ— â†’ []â‚œ-ext-freshâ‚œ-dec decP Hext t Î» n Pn â†’ freshR$Ì‡-elim (Hfresh n Pn) t tâˆˆâƒ—
[]áµ©-ext-fresháµ©-dec {P} decP Hext (Ï† â†’Ì‡ Ïˆ) Hfresh = cong2 _â†’Ì‡_
  ([]áµ©-ext-fresháµ©-dec decP Hext Ï† Î» n Pn â†’ fst $ freshâ†’Ì‡-elim $ Hfresh n Pn)
  ([]áµ©-ext-fresháµ©-dec decP Hext Ïˆ Î» n Pn â†’ snd $ freshâ†’Ì‡-elim $ Hfresh n Pn)
[]áµ©-ext-fresháµ©-dec {P} {Ïƒ} {Ï„} decP Hext (âˆ€Ì‡ Ï†) Hfresh = cong âˆ€Ì‡_ $
  []áµ©-ext-fresháµ©-dec {P = Pâ€²} H1 H2 Ï† H3 where
  Pâ€² : â„• â†’ ğ•‹ _
  Pâ€² zero = âŠ¥*
  Pâ€² (suc n) = P n
  H1 : Decâ„™ Pâ€²
  H1 zero = no Î» ()
  H1 (suc n) = decP n
  H2 : âˆ€ n â†’ Â¬ Pâ€² n â†’ â†‘â‚› Ïƒ n â‰¡ â†‘â‚› Ï„ n
  H2 zero _ = refl
  H2 (suc n) Â¬Pn = (cong (_[ # âˆ˜ suc ]â‚œ)) (Hext n Â¬Pn)
  H3 : âˆ€ n â†’ Pâ€² n â†’ fresháµ© n Ï†
  H3 (suc n) Pn = freshâˆ€Ì‡-elim (Hfresh n Pn)
```

```agda
[]áµ©-ext-fresháµ© : fresháµ© n Ï† â†’ (âˆ€ m â†’ m â‰¢ n â†’ Ïƒ m â‰¡ Ï„ m) â†’ Ï† [ Ïƒ ]áµ© â‰¡ Ï† [ Ï„ ]áµ©
[]áµ©-ext-fresháµ© {n} {Ï†} Hfresh Hext = []áµ©-ext-fresháµ©-dec {P = _â‰¡ n} (Î» _ â†’ it) Hext Ï† Î» { _ refl â†’ Hfresh }
```

---
> çŸ¥è¯†å…±äº«è®¸å¯åè®®: [CC-BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)  
> [GitHub](https://github.com/choukh/MetaLogic/blob/main/src/FOL/Syntax/SubstitutionFacts.lagda.md) | [GitHub Pages](https://choukh.github.io/MetaLogic/FOL.Syntax.SubstitutionFacts.html) | [è¯­é›€](https://www.yuque.com/ocau/metalogic/fol.syntax.substitution)  
> äº¤æµQç¾¤: 893531731
